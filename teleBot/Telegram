import time
import telepot
from telepot.loop import MessageLoop
import json
import requests
import time
import cherrypy

def handle(msg):
    content_type, chat_type, chat_id = telepot.glance(msg)
    print(content_type, chat_type, chat_id)

    if msg['text'] == '/start':
        bot.sendMessage(chat_id, 'Welcome to the museum!')
    elif msg['text'] == '/info':
        bot.sendMessage(chat_id, 'the Museum')


def on_chat_message(msg):
    content_type, chat_type, chat_id = telepot.glance(msg)
    if msg['text'] == '/switchoff':
        mark_up = ReplyKeyboardMarkup(keyboard=[['zoneA'],['zoneB'],['zoneC'],['zoneD']], one_time_keyboard=True)
        bot.sendMessage(chat_id, text='What light would you like to turn off?', reply_markup=mark_up)
    elif msg['text'] == 'switchon':
        bot.sendMessage(chat_id, text='turn on all the lights', reply_markup=mark_up)

def get_url():
    contents = requests.get('https://thingspeak.com/channels/1334459').json()
    url = contents['url']
    return url

def send_photo(bot, update):
    url = get_url()
    chat_id = update.message.chat_id
    bot.send_photo(chat_id=chat_id, photo=url)      

TOKEN = '1763352169:AAEcAAE8wmmNIYg1PQ8RH6yMRDZ3FV7ebHQ'

bot = telepot.Bot(TOKEN)
MessageLoop(bot, handle).run_as_thread()
print ('waiting ...')

# Keep the program running.
while 1:
    time.sleep(10)
